<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <main>
      <section>
        <h4>Status</h4>
        <p>svg-width :<span id="svg-width-label">1100</span></p>
        <p>search-round :<span id="search-count">0</span></p>
      </section>
      <section id="svg-area">
        <h4>SVG</h4>
      </section>
      <section>
        <article>
          <h4>Data</h4>
          <div>
            <label for="width">width</label>
            <input type="text" id="width" name="width" value="1100" />
          </div>
          <div>
            <label for="data-list">type each data seperated with commas</label>
            <input
              type="text"
              id="data-list"
              name="data-list"
              value="55,21,64,1,6,7,12"
            />
          </div>
          <div>
            <label for="target">target number to find</label>
            <input type="text" id="target" name="target" value="12" />
          </div>
          <div>
            <button id="start-binary-search" name="start-binary-search">
              start simulation
            </button>
          </div>
        </article>
      </section>
    </main>
    <script>

      //TODO: 파일 분할 해서 함수 호출



      const elById = (target) => document.getElementById(target);

      const inputData = (el) => {return el.value.indexOf(",") > -1
          ? el.value
              .split(",")
              .map((_) => Number(_))
              .filter((v) => typeof v === "number" && v)
          : Number(el.value);}

      const genSize = (w, d) => {
        const unit = (w + 80 - (80 / d.length)) / d.length;
        const gap = unit / d.length;
        const box = d.length * 80 > w - unit ? 80 - (80 / d.length) : 80;
        return {
          gap,
          box,
          unit,
          width: w,
          height: 500,
          margin: 50,
          data: { text: { width: 30, height: 20 }, box },
          line: 3,
        };
      };

      const genElement = (type, attr) => {
        type = document.createElementNS("http://www.w3.org/2000/svg", type);
        for (const [t, v] of Object.entries(attr)) {
          type.setAttributeNS(null, t.toLowerCase(), v);
        }
        return type;
      };
      /**
       *   요소의 x거리를 알아야 하는 경우에는 i를 인자로 받음
       * */
      const genAttr = (w, s, i) => {
        // s = 
        // const deepCopy = (obj) =>
        // {
        //   let copiedObj = {}
        //   for(const [k,v] of Object.entries(obj))
        //   {
        //     s[k] = v
        //     // console.log(s)
        //   }
        // }
        // deepCopy(s)
        const [m,h,d] = [s.margin, s.height, s.data]
        const color = { bg: "black", default: "white", focus: "red" }
        const style =  { line: `stroke: ${color.default}; stroke-width: ${s.line}` }
        const svg = {
            width: w,
            height: h,
            viewBox: `${m} ${m} ${w} ${h}`,
          }
        const list = {
          g: {

          },
          eventArea: {
            ...svg,
            fill: color.bg,
          },
          indicatorLine: {
            x1: h + m,
            y1: 0,
            x2: h + m,
            y2: h,
            style: style.line,
          },
          dataText: {
            width: d.text.width,
            height: d.text.height,
            x: (i * s.unit) / 1.1 + 65,
            y: h / 2 - m,
            fill: color.default,
            "dominant-baseline": "end",
            "text-anchor": "end",
          },
          dataBox: {
            width: d.box,
            height: d.box,
            x: (i * s.unit) / 1.1 + 20,
            y: h / 2 - m * 2,
            stroke: color.default,
            "stroke-width": s.line,
          },
          line: {
            x1:h+ s.gap, 
            y1:0, 
            x2:h+ s.gap,
            y2:h, 
            style: style.line 
          }
        };
        return {svg,...list}
      };


      // TODO: 요소를 생성
      const getElement  = (w,arr,size,gen,attr,i) => (target, type) =>  gen(type, attr(w, size(w,arr), i)[target])


      const width = inputData(elById('width'))
      const d = inputData(elById('data-list'))
      console.log(d)
      const textParams = [width,d,genSize,getElement,genElement,genAttr]
      const createEl = getElement(width,d,genSize,genElement,genAttr)
      const svg = createEl('svg','svg')
      const eventArea =  createEl('eventArea','rect')
      const group =  createEl('g','g')
      const line =  createEl('line','line')
      elById('svg-area').appendChild(svg)
     svg.appendChild(eventArea)
     svg.appendChild(group)
     group.appendChild(line)
    //  group.appendChild(text)
    //  group.appendChild(box)
      //   svgArea.appendChild(svg);
      //   svg.appendChild(eventArea);
      //   svg.appendChild(indicatorLine);
      const onChangeInput= (params,copy)=>(e) => {console.log(e)};
      const updateTexts = ( w, d, size,get,gen,attr) => (g) => {
        let i = 0;
        while(g.fistChild && g.lastChild)
        {
          g.removeChild(g.lastChild)
        }
        for (const text of d) {
          const createEl = get(w,d,size,gen,attr,i)
          const [data,box,group] =  [createEl('dataText','text'), createEl('dataBox','rect'), createEl('g','g')]
          data.textContent = text;
          group.appendChild(box);
          group.appendChild(data);
          g.appendChild(group)

          i++;
        }
      };
      // 파라메터로 받은 배열 원소들을 다른 함수에서 사용하기위해
      const copyParams = params => {
        console.log(params)
          const copied =  {}
          for(const [i,variable] of Object.entries(params)){
            if(variable.name === undefined){
                  copied[variable.tagName] = variable
          }else if (typeof variable === "function") {
            copied[variable.name] = variable
          }
        }
        console.log(copied)
          return copied
        }
      const initParams = [inputData, elById, genSize, genElement, getElement,genAttr,onChangeInput,updateTexts,group,svg];
      const init = (vars,copy) => {
        const _ = copy(vars)
        const w = _.inputData(_.elById("width"))
        const d = _.inputData(_.elById('data-list'))
        const onChangeInput = _.onChangeInput(vars,copy)
        _.elById("width").addEventListener("input", onChangeInput);
        _.elById("data-list").addEventListener("input", onChangeInput);
        _.updateTexts(w,d,_.genSize,_.getElement,_.genElement,_.genAttr)(_.g);
      };
      init(initParams,copyParams)
      // 제너레이터로 svg 지우고 -> 엘레먼트를 추가하는 과정들을 반복해준다.



    </script>
  </body>
</html>
